<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Camera Guide App</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; text-align: center; }
        .container { position: relative; width: 100vw; height: 100vh; display: flex; flex-direction: column; }
        
        video { width: 100%; height: 100%; object-fit: cover; }

        /* ガイド画像 */
        .guide-overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            pointer-events: none;
            opacity: 0.6;
        }

        /* シャッターボタンのデザイン */
        .shutter-btn {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            border: 5px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            cursor: pointer;
        }
        .shutter-btn:active { background: #ccc; }

        /* 隠しキャンバス（保存用） */
        canvas { display: none; }
    </style>
</head>
<body>

<div class="container">
    <video id="video" autoplay playsinline></video>
    <img id="guide" class="guide-overlay" src="AA.png" alt="Guide">
    
    <div id="shutter" class="shutter-btn"></div>
</div>

<canvas id="canvas"></canvas>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const shutter = document.getElementById('shutter');
    const guide = document.getElementById('guide');

    // カメラ起動
    navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" },
        audio: false
    })
    .then(stream => { video.srcObject = stream; })
    .catch(err => { alert("カメラの起動に失敗しました。"); });

    // シャッターボタンが押された時の処理
    shutter.addEventListener('click', () => {
        const ctx = canvas.getContext('2d');
        
        // カメラの解像度に合わせてキャンバスのサイズを設定
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        // 1. カメラ映像を描画
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        // 2. ガイド画像を重ねて描画
        // (CSSの80%幅に合わせて計算)
        const guideWidth = canvas.width * 0.8;
        const guideHeight = guide.naturalHeight * (guideWidth / guide.naturalWidth);
        const x = (canvas.width - guideWidth) / 2;
        const y = (canvas.height - guideHeight) / 2;
        
        ctx.globalAlpha = 0.6; // ガイドの透明度
        ctx.drawImage(guide, x, y, guideWidth, guideHeight);
        ctx.globalAlpha = 1.0;

        // 3. 画像としてダウンロード（または表示）
        const link = document.createElement('a');
        link.download = `photo_${new Date().getTime()}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
    });
</script>

</body>
</html>
